---
title: "CATS_cam_EDA"
author: "JHMoxley"
date: "9/13/2018"
output: pdf_document
params: 
  dd: "/Volumes/Avalon"               #deploy drive
  deploy.key: "APT_CC0704_20180803"   #deploy ID
  datFreq: 50 #Hz                     #motion sensing sampling res
  datFreq.desired: 1 #Hz              #downsampled res
  smoothing: 5                        #number seconds to smooth traces
  SI: FALSE                           #extract files from SI converted dB
  sensors: !r c("acc", "mag")
---
This is a generalized EDA document for quickly working up biologging deployments returned from CATS tags on White Sharks.  Test built on APT_CC0705_07182018, based on EDA files associated with this deployment. 

rmarkdown::render('CATS_preprocess_RMrkD.Rmd',params= list( deploy.key = "APT_CC0705_07182018"))

```{r}
params
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("tag_fxns.R")
library(tidyverse)
setwd(file.path(params$dd, params$deploy.key))
#create EDA folder??
#good way to track what generation of tag fxns it used?  

#load in data
ifelse(isTRUE(params$SI), 
       print("reading in SI converted data"),
       print("reading in RAW data"))
dat <- load.in2(dir = ifelse(isTRUE(params$SI),
             str_subset(list.dirs(), "(SI)"),
             getwd()), 
             sensors = params$sensors, fstop = 2)
```

## Smoothing, isolation & manipulation

```{r}
df <- dat$dat
#smooth depth
dat$data$depth <- stats::filter(subset(dat$data, select = dat$sensors$depth[1]),
                               filter = rep(1,params$smoothing*dat$sensors$sfreq)/
                                 (params$smoothing*dat$sensors$sfreq), sides = 2, circular = T)
#smooth temp reading from depth sensor
dat$data$temp.dep <- stats::filter(subset(dat$data, select = dat$sensors$depth[2]),
                               filter = rep(1,params$smoothing*dat$sensors$sfreq)/
                                 (params$smoothing*dat$sensors$sfreq), sides = 2, circular = T)
#smooth temp imu
dat$data$temp.dep <- stats::filter(subset(dat$data, select = dat$sensors$temp),
                               filter = rep(1,params$smoothing*dat$sensors$sfreq)/
                                 (params$smoothing*dat$sensors$sfreq), sides = 2, circular = T)

plot(x = 1:nrow(dat$data), y = dat$data$depth, type = "l", main = params$deploy.key)
```

## Acceleartion


```{r pressure, echo=FALSE}
library(gRumble)
if(any(str_detect(params$sensors, "^a|A")){
  #isolate gravitation
  gees <- data.frame(Gsep(as.matrix(subset(dat$data, select = dat$sensors$acc)), 
                          filt = (rep(1, params$smoothing*dat$sensors$sfreq))/(params$smoothing*dat$sensors$sfreq)))
  g2 <- data.frame(apply(gees, 2, collapse, freq = params$datFreq.desired))
}else{
  warning("ACCEL SENSORS WERE NOT INCLUDED IN PARAMS")
}
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
